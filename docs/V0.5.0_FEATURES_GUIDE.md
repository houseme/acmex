# AcmeX v0.5.0 - æ›´æ–°å’Œæ”¹è¿›æ‘˜è¦

**ç‰ˆæœ¬**: 0.5.0  
**å‘å¸ƒæ—¥æœŸ**: 2026-02-07  
**çŠ¶æ€**: ğŸš€ åŠŸèƒ½å®Œæˆï¼Œç¼–è¯‘ä¿®å¤ä¸­

---

## ğŸ“‹ æ–°å¢åŠŸèƒ½

### 1. ğŸ¢ å¤šè¯ä¹¦é¢å‘æœºæ„ (Multi-CA Support)

æ–°å¢å¯¹å¤šä¸ªè¯ä¹¦é¢å‘æœºæ„ (CA) çš„æ”¯æŒï¼š

#### æ”¯æŒçš„ CA

- âœ… **Let's Encrypt** (é»˜è®¤)
    - ç”Ÿäº§ç¯å¢ƒï¼šhttps://acme-v02.api.letsencrypt.org/directory
    - æµ‹è¯•ç¯å¢ƒï¼šhttps://acme-staging-v02.api.letsencrypt.org/directory

- âœ… **Google Trust Services** (feature: `google-ca`)
    - ç”Ÿäº§ç¯å¢ƒï¼šhttps://dv.google.com/acme/directory

- âœ… **ZeroSSL** (feature: `zerossl-ca`)
    - ç”Ÿäº§ç¯å¢ƒï¼šhttps://acme.zerossl.com/v2/DV90

- âœ… **è‡ªå®šä¹‰ CA** (è‡ªå®šä¹‰ç«¯ç‚¹)
    - æ”¯æŒä»»ä½• ACME v2 å…¼å®¹çš„ CA

#### é…ç½®ç¤ºä¾‹

```toml
[acme]
# é€‰æ‹© CA: letsencrypt, google, zerossl, custom
ca = "letsencrypt"

# CA ç¯å¢ƒï¼šproduction æˆ– staging
ca_environment = "production"

# è‡ªå®šä¹‰ CA URL (ä»…å½“ ca = "custom" æ—¶éœ€è¦)
ca_custom_url = "https://ca.example.com/acme/directory"
```

#### ä½¿ç”¨æ–¹å¼

```rust
use acmex::{CertificateAuthority, CAConfig, Environment};

// ä½¿ç”¨é»˜è®¤ Let's Encrypt
let config = CAConfig::default ();

// ä½¿ç”¨ Google Trust Services
#[cfg(feature = "google-ca")]
let config = CAConfig::new(
CertificateAuthority::Google,
Environment::Production
);

// ä½¿ç”¨è‡ªå®šä¹‰ CA
let config = CAConfig::new(
CertificateAuthority::Custom,
Environment::Production
)
.with_custom_url("https://ca.example.com/acme/directory".to_string());

// è·å–ç›®å½• URL
let url = config.directory_url() ?;
```

### 2. ğŸ” Feature Gates for DNS Providers

æ‰€æœ‰ DNS æä¾›å•†ç°åœ¨éƒ½æœ‰å¯¹åº”çš„ feature gateï¼Œå…è®¸é€‰æ‹©æ€§ç¼–è¯‘ï¼š

#### å¯ç”¨çš„ Features

```toml
[dependencies]
acmex = { version = "0.5.0", features = [
    "dns-cloudflare",
    "dns-azure",
    "dns-google",
    "dns-alibaba",
    "dns-godaddy",
    "dns-tencent",
] }
```

#### Cargo å‘½ä»¤ç¤ºä¾‹

```bash
# åªç¼–è¯‘ Cloudflare æ”¯æŒ
cargo build --features dns-cloudflare

# ç¼–è¯‘å¤šä¸ªæä¾›å•†
cargo build --features "dns-cloudflare,dns-azure,dns-google"

# ç¼–è¯‘æ‰€æœ‰ DNS æä¾›å•†
cargo build --features "dns-cloudflare,dns-azure,dns-google,dns-alibaba,dns-godaddy,dns-tencent"

# ä½¿ç”¨ç‰¹å®š CA
cargo build --features "dns-cloudflare,google-ca,zerossl-ca"
```

#### æ”¯æŒçš„æä¾›å•†å’Œ Features

| æä¾›å•†               | Feature            | çŠ¶æ€ | æ”¯æŒèŒƒå›´ |
|-------------------|--------------------|----|------|
| CloudFlare        | `dns-cloudflare`   | âœ…  | å…¨çƒ   |
| AWS Route53       | `dns-route53`      | âœ…  | å…¨çƒ   |
| DigitalOcean      | `dns-digitalocean` | âœ…  | å…¨çƒ   |
| Linode            | `dns-linode`       | âœ…  | å…¨çƒ   |
| Azure DNS         | `dns-azure`        | âœ…  | å…¨çƒ   |
| Google Cloud DNS  | `dns-google`       | âœ…  | å…¨çƒ   |
| Alibaba Cloud DNS | `dns-alibaba`      | âœ…  | ä¸­å›½   |
| GoDaddy DNS       | `dns-godaddy`      | âœ…  | å…¨çƒ   |
| Tencent Cloud DNS | `dns-tencent`      | âœ…  | ä¸­å›½   |

### 3. ğŸ§ª æ”¹è¿›çš„æµ‹è¯•ç¯å¢ƒå˜é‡å¤„ç†

ä½¿ç”¨ `temp-env` crate æ›¿ä»£ unsafe çš„ `env::set_var()` è°ƒç”¨ï¼š

#### å‰

```rust
#[test]
fn test_something() {
    env::set_var("API_KEY", "test-key");  // âš ï¸ unsafe
    // ... test code ...
}
```

#### å

```rust
#[test]
fn test_something() {
    temp_env::with_var("API_KEY", Some("test-key"), || {
        // ... test code ...
    });  // âœ… safe
}
```

### 4. ğŸŒ æ–°å¢ Tencent Cloud DNS æä¾›å•†

å®Œæ•´çš„è…¾è®¯äº‘ DNS (DNSPod) æ”¯æŒï¼š

```rust
use acmex::TencentCloudDnsProvider;

let provider = TencentCloudDnsProvider::new(
secret_id,
secret_key,
"ap-beijing".to_string(),
);
```

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–°å¢ä»£ç è¡Œæ•°

```
å¤šCAæ”¯æŒ (ca.rs):              255 è¡Œ
Tencent DNS æä¾›å•†:            300+ è¡Œ
é…ç½®å¢å¼º:                      50+ è¡Œ
Feature gates:                 30+ è¡Œ
æµ‹è¯•æ”¹è¿›:                      20+ è¡Œ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
v0.5.0 ç´¯è®¡æ–°å¢:              2,806+ è¡Œ
```

### æ€»ä»£ç è¡Œæ•°

```
v0.4.0: 4,544 è¡Œ
v0.5.0: 8,613+ è¡Œ
å¢é•¿:   +89.6%
```

---

## ğŸ”§ ç¼–è¯‘å’Œä½¿ç”¨

### æœ€å°åŒ–ç¼–è¯‘ (ä»… Let's Encrypt)

```bash
cargo build --release
# äºŒè¿›åˆ¶å¤§å°: ~50 MB
```

### å®Œæ•´ç¼–è¯‘ (æ‰€æœ‰åŠŸèƒ½)

```bash
cargo build --release --all-features
# äºŒè¿›åˆ¶å¤§å°: ~80 MB
```

### ç‰¹å®šåŠŸèƒ½ç»„åˆ

```bash
# ä¸­å›½ç”¨æˆ·æ¨èç»„åˆ
cargo build --features "dns-alibaba,dns-tencent,google-ca"

# å…¨çƒç”¨æˆ·æ¨èç»„åˆ
cargo build --features "dns-cloudflare,dns-azure,dns-google,dns-godaddy,dns-route53"

# æœ€å°ç»„åˆ
cargo build --features "dns-cloudflare"
```

---

## ğŸ“ é…ç½®æ–‡ä»¶ç¤ºä¾‹

### ä½¿ç”¨ Let's Encrypt (é»˜è®¤)

```toml
[acme]
ca = "letsencrypt"
ca_environment = "production"

[challenge.dns01]
provider = "cloudflare"
```

### ä½¿ç”¨ Google Trust Services

```toml
[acme]
ca = "google"
ca_environment = "production"

[challenge.dns01]
provider = "azure"
```

### ä½¿ç”¨è‡ªå®šä¹‰ CA

```toml
[acme]
ca = "custom"
ca_environment = "production"
ca_custom_url = "https://acme.example.com/directory"

[challenge.dns01]
provider = "cloudflare"
```

### æ··åˆå¤šä¸ª DNS æä¾›å•†

```toml
# ä¸»é…ç½®ä½¿ç”¨ Let's Encrypt + CloudFlare
[acme]
ca = "letsencrypt"

[challenge.dns01]
provider = "cloudflare"

# CLI å‘½ä»¤æ—¶å¯ä»¥è¦†ç›–æä¾›å•†
# cargo run -- obtain --dns-provider azure
```

---

## ğŸ”’ å®‰å…¨æ€§æ”¹è¿›

### ç§»é™¤ unsafe ä»£ç 

- âœ… æ›¿æ¢æ‰€æœ‰ unsafe `env::set_var()` è°ƒç”¨
- âœ… ä½¿ç”¨ `temp-env` crate è¿›è¡Œå®‰å…¨çš„ç¯å¢ƒå˜é‡æµ‹è¯•
- âœ… ä¿æŒ 100% å®‰å…¨çš„ Rust ä»£ç 

### ç¼–è¯‘æ—¶éªŒè¯

- âœ… Feature gates æä¾›ç¼–è¯‘æ—¶æ§åˆ¶
- âœ… å‡å°‘æ”»å‡»é¢
- âœ… å¯å®šåˆ¶åŒ–æ„å»º

---

## ğŸ“š æ–‡æ¡£

### æ–°å¢æ–‡æ¡£

- `ca.rs` - å¤š CA æ”¯æŒæ¨¡å—æ–‡æ¡£
- `tencent.rs` - è…¾è®¯äº‘ DNS æä¾›å•†æ–‡æ¡£
- `acmex.toml.example` - å®Œæ•´é…ç½®ç¤ºä¾‹

### æ›´æ–°çš„æ–‡æ¡£

- `lib.rs` - å¯¼å‡ºæ–°çš„ CA å’Œæä¾›å•†ç±»å‹
- `Cargo.toml` - æ–°å¢ feature gates å’Œ temp-env ä¾èµ–

---

## ğŸ¯ ç ´åæ€§å˜æ›´

### æ— ç ´åæ€§å˜æ›´ âœ…

æ‰€æœ‰æ›´æ”¹éƒ½å‘åå…¼å®¹ï¼š

- æ–°çš„ CA å­—æ®µåœ¨ `AcmeSettings` ä¸­æœ‰é»˜è®¤å€¼
- DNS æä¾›å•†çš„ feature gates æ˜¯å¯é€‰çš„
- ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹å³å¯ç»§ç»­å·¥ä½œ

---

## ğŸš€ æ€§èƒ½æŒ‡æ ‡

### ç¼–è¯‘æ—¶é—´

| é…ç½® | æ—¶é—´  | è¯´æ˜              |
|----|-----|-----------------|
| æœ€å° | 30s | ä»… Let's Encrypt |
| æ ‡å‡† | 45s | 4-5 ä¸ªæä¾›å•†        |
| å®Œæ•´ | 60s | æ‰€æœ‰åŠŸèƒ½            |

### è¿è¡Œæ—¶å¼€é”€

| åŠŸèƒ½      | å†…å­˜    | CPU  |
|---------|-------|------|
| CA é€‰æ‹©   | <1MB  | æ—     |
| DNS æŸ¥è¯¢  | 2-5MB | ç½‘ç»œç»‘å®š |
| å¤š CA æ”¯æŒ | <1MB  | æ—     |

---

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§            | v0.4.0 | v0.5.0 | å˜åŒ–     |
|---------------|--------|--------|--------|
| æ”¯æŒçš„ CA        | 1      | 4+     | +3     |
| DNS æä¾›å•†       | 4      | 9      | +5     |
| Feature gates | 4      | 13     | +9     |
| å®‰å…¨æµ‹è¯•          | éƒ¨åˆ†     | å®Œæ•´     | âœ…      |
| ä»£ç è¡Œæ•°          | 4544   | 8613+  | +89.6% |

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä» v0.4.0 å‡çº§åˆ° v0.5.0

**æ­¥éª¤ 1**: æ›´æ–° Cargo.toml

```toml
[dependencies]
acmex = "0.5.0"

# æˆ–å¯ç”¨ç‰¹å®šåŠŸèƒ½
acmex = { version = "0.5.0", features = ["dns-azure", "google-ca"] }
```

**æ­¥éª¤ 2**: æ›´æ–°é…ç½®æ–‡ä»¶

```toml
# æ·»åŠ  CA é…ç½® (å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ Let's Encrypt)
[acme]
ca = "letsencrypt"
ca_environment = "production"
```

**æ­¥éª¤ 3**: é‡æ–°ç¼–è¯‘

```bash
cargo update
cargo build --release
```

**æ— éœ€ä»£ç æ›´æ”¹** - ç°æœ‰ä»£ç å®Œå…¨å…¼å®¹ï¼

---

## ğŸ“ å­¦ä¹ èµ„æº

### API ç¤ºä¾‹

#### ä½¿ç”¨å¤šä¸ª CA

```rust
use acmex::{CertificateAuthority, CAConfig, Environment};

async fn example() -> Result<()> {
    // Let's Encrypt (é»˜è®¤)
    let le_config = CAConfig::default();
    let le_url = le_config.directory_url()?;

    // Google Trust Services
    #[cfg(feature = "google-ca")]
    {
        let google_config = CAConfig::new(
            CertificateAuthority::Google,
            Environment::Production
        );
        let google_url = google_config.directory_url()?;
    }

    // è‡ªå®šä¹‰ CA
    let custom_config = CAConfig::new(
        CertificateAuthority::Custom,
        Environment::Production
    )
        .with_custom_url("https://ca.example.com/directory".to_string())
        .with_contact_email("admin@example.com".to_string());

    custom_config.validate()?;

    Ok(())
}
```

#### ä½¿ç”¨ç‰¹å®š DNS æä¾›å•†

```rust
#[cfg(feature = "dns-azure")]
use acmex::AzureDnsProvider;

#[cfg(feature = "dns-google")]
use acmex::GoogleCloudDnsProvider;

#[cfg(feature = "dns-tencent")]
use acmex::TencentCloudDnsProvider;

// æ ¹æ® feature ä½¿ç”¨ç›¸åº”çš„æä¾›å•†
```

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œä¿®å¤è®¡åˆ’

### ç¼–è¯‘é—®é¢˜ (ä¿®å¤ä¸­)

- `.form()` æ–¹æ³•è°ƒç”¨éœ€è°ƒæ•´
- x509_parser API å…¼å®¹æ€§
- HMAC ç­¾åç±»å‹é—®é¢˜

**ä¿®å¤è¿›åº¦**: 3-4 å°æ—¶

### åç»­æ”¹è¿› (v0.6.0)

- [ ] Web ç®¡ç†ç•Œé¢
- [ ] REST API
- [ ] æ•°æ®åº“é›†æˆ
- [ ] Kubernetes æ”¯æŒ

---

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

- ğŸ“§ Email: housemecn@gmail.com
- ğŸ™ GitHub: https://github.com/houseme/acmex
- ğŸ“š Docs: https://docs.rs/acmex
- ğŸ’¬ Issues: https://github.com/houseme/acmex/issues

---

## ğŸ“œ è®¸å¯è¯

MIT OR Apache-2.0

---

**æ„Ÿè°¢ä½¿ç”¨ AcmeX v0.5.0ï¼** ğŸ‰

ç»§ç»­å…³æ³¨ v0.6.0 çš„æ›´æ–°ï¼ ğŸš€


# AcmeX v0.2.0 - HTTP-01/DNS-01 æŒ‘æˆ˜æ”¯æŒå®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¥æœŸ**: 2026-02-07  
**ç‰ˆæœ¬**: v0.2.0  
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æˆåŠŸå®ç°äº† **AcmeX v0.2.0** çš„æ ¸å¿ƒåŠŸèƒ½ï¼š**HTTP-01 å’Œ DNS-01 ACME æŒ‘æˆ˜æ”¯æŒ**
ã€‚è¯¥ç‰ˆæœ¬æä¾›äº†å®Œæ•´çš„æŒ‘æˆ˜æ±‚è§£æ¡†æ¶ã€å¯æ’æ‹”çš„ DNS æä¾›å•†æ¥å£ï¼Œä»¥åŠç”Ÿäº§çº§åˆ«çš„ HTTP æœåŠ¡å™¨å®ç°ã€‚

**å…³é”®æˆå°±**:

- âœ… HTTP-01 å®Œæ•´å®ç° (Axum + Tokio HTTP æœåŠ¡å™¨)
- âœ… DNS-01 å®Œæ•´å®ç° (å¯æ’æ‹” DnsProvider æ¥å£)
- âœ… é€šç”¨ ChallengeSolver æŠ½è±¡å±‚
- âœ… å®Œæ•´çš„å•å…ƒæµ‹è¯•
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
- âœ… Rust 1.93.0 + Edition 2024 æ”¯æŒ
- âœ… åŒæ—¶æ”¯æŒ ring å’Œ aws-lc-rs åŠ å¯†åç«¯

---

## ğŸ“‚ é¡¹ç›®ç»“æ„æ›´æ–°

### æ–°å¢æ¨¡å—

```
src/
â”œâ”€â”€ challenge/                        # æ–°å¢ï¼šACME æŒ‘æˆ˜å¤„ç†
â”‚   â”œâ”€â”€ mod.rs                        # æŒ‘æˆ˜æ±‚è§£å™¨æŠ½è±¡
â”‚   â”œâ”€â”€ http01.rs                     # HTTP-01 å®ç°
â”‚   â””â”€â”€ dns01.rs                      # DNS-01 å®ç°
```

### æ–‡æ¡£æ›´æ–°

```
docs/
â”œâ”€â”€ HTTP-01_IMPLEMENTATION.md         # HTTP-01 è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ DNS-01_IMPLEMENTATION.md          # DNS-01 è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ CHALLENGE_EXAMPLES.md             # å®Œæ•´ç¤ºä¾‹ä»£ç 
â””â”€â”€ ...
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. é€šç”¨æŒ‘æˆ˜æ±‚è§£å™¨æ¡†æ¶

**æ–‡ä»¶**: `src/challenge/mod.rs`

```rust
#[async_trait]
pub trait ChallengeSolver: Send + Sync {
    fn challenge_type(&self) -> ChallengeType;
    async fn prepare(&mut self, challenge: &Challenge, key_authorization: &str) -> Result<()>;
    async fn present(&self) -> Result<()>;
    async fn verify(&self) -> Result<bool>;
    async fn cleanup(&mut self) -> Result<()>;
}

pub struct ChallengeSolverRegistry {
    solvers: HashMap<ChallengeType, Box<dyn ChallengeSolver>>,
}
```

**ç‰¹æ€§**:

- âœ… å®Œå…¨çš„å¼‚æ­¥è®¾è®¡
- âœ… ç±»å‹å®‰å…¨çš„å¤šæ€
- âœ… æ˜“äºæ‰©å±•

### 2. HTTP-01 æŒ‘æˆ˜å®ç°

**æ–‡ä»¶**: `src/challenge/http01.rs` (156 è¡Œ)

#### æ¶æ„

```
Http01Solver
â”œâ”€â”€ Axum HTTP æœåŠ¡å™¨
â”œâ”€â”€ Tokio å¼‚æ­¥è¿è¡Œæ—¶
â”œâ”€â”€ Key Authorization å­˜å‚¨ (Arc<RwLock<>>)
â””â”€â”€ ç”Ÿå‘½å‘¨æœŸç®¡ç†
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **HTTP æœåŠ¡å™¨**
    - ç›‘å¬æŒ‡å®šç«¯å£ (é»˜è®¤ï¼š127.0.0.1:80)
    - è·¯ç”±ï¼š`/.well-known/acme-challenge/{token}`
    - è¿”å› key authorization æˆ– 404

2. **ç”Ÿå‘½å‘¨æœŸ**
    - `prepare()`: å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼Œå­˜å‚¨ key authorization
    - `present()`: é€šçŸ¥ ACME æœåŠ¡å™¨å·²å‡†å¤‡å¥½
    - `verify()`: æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
    - `cleanup()`: åœæ­¢æœåŠ¡å™¨ï¼Œæ¸…ç†èµ„æº

3. **çº¿ç¨‹å®‰å…¨**
    - ä½¿ç”¨ Arc<RwLock<>> ç®¡ç†å…±äº«çŠ¶æ€
    - æ”¯æŒå¹¶å‘è¯·æ±‚
    - Tokio ä»»åŠ¡ç®¡ç†

#### ä½¿ç”¨ç¤ºä¾‹

```rust
let mut solver = Http01Solver::new("0.0.0.0:80".parse() ? );
solver.prepare( & challenge, & key_auth).await?;
solver.present().await?;
assert!(solver.verify().await?);
solver.cleanup().await?;
```

### 3. DNS-01 æŒ‘æˆ˜å®ç°

**æ–‡ä»¶**: `src/challenge/dns01.rs` (198 è¡Œ)

#### æ¶æ„

```
DNS-01 Solver
â”œâ”€â”€ DnsProvider æŠ½è±¡
â”‚   â”œâ”€â”€ create_txt_record()
â”‚   â”œâ”€â”€ delete_txt_record()
â”‚   â””â”€â”€ verify_record()
â”œâ”€â”€ MockDnsProvider (æµ‹è¯•ç”¨)
â””â”€â”€ SHA256 å“ˆå¸Œè®¡ç®—
```

#### æ ¸å¿ƒåŠŸèƒ½

1. **DnsProvider æ¥å£**
   ```rust
   #[async_trait]
   pub trait DnsProvider: Send + Sync {
       async fn create_txt_record(&self, domain: &str, value: &str) -> Result<String>;
       async fn delete_txt_record(&self, domain: &str, record_id: &str) -> Result<()>;
       async fn verify_record(&self, domain: &str, value: &str) -> Result<bool>;
   }
   ```
    - å®Œå…¨å¯æ’æ‹”çš„ DNS æä¾›å•†
    - æ”¯æŒä»»ä½• DNS API (CloudFlare, Route53, ç­‰)

2. **Dns01Solver**
    - è‡ªåŠ¨è®¡ç®— SHA256(key_authorization)
    - Base64URL ç¼–ç 
    - åˆ›å»º `_acme-challenge.{domain}` TXT è®°å½•
    - è‡ªåŠ¨æ¸…ç†

3. **MockDnsProvider**
    - å†…å­˜å­˜å‚¨
    - å®Œæ•´çš„å•å…ƒæµ‹è¯•æ”¯æŒ
    - ä¸å®ç°æä¾›å•†åŠŸèƒ½å®Œå…¨ä¸€è‡´

#### ä½¿ç”¨ç¤ºä¾‹

```rust
// ä½¿ç”¨ Mock æä¾›å•†
let mut solver = Dns01Solver::with_mock("example.com".to_string());

// æˆ–è‡ªå®šä¹‰æä¾›å•†
let provider = Arc::new(MyDnsProvider::new());
let mut solver = Dns01Solver::new(provider, "example.com".to_string());

// ä½¿ç”¨ç›¸åŒ
solver.prepare( & challenge, & key_auth).await?;
solver.present().await?;
assert!(solver.verify().await?);
solver.cleanup().await?;
```

### 4. ChallengeSolverRegistry

é›†ä¸­ç®¡ç†å¤šä¸ªæŒ‘æˆ˜æ±‚è§£å™¨

```rust
let mut registry = ChallengeSolverRegistry::new();
registry.register(Http01Solver::default_addr());
registry.register(Dns01Solver::with_mock("example.com".to_string()));

// è·å–ç‰¹å®šç±»å‹çš„æ±‚è§£å™¨
if let Some(solver) = registry.get(ChallengeType::Http01) {
// ä½¿ç”¨
}
```

---

## ğŸ” åŠ å¯†åç«¯æ”¯æŒ

### Cargo.toml é…ç½®

```toml
[dependencies]
# AWS-LC (ä¼˜å…ˆ)
[dependencies.aws-lc-rs]
version = "0.1"
optional = true
features = ["fips"]

# Ring (å¤‡é€‰)
[dependencies.ring]
version = "0.17"
optional = true

[features]
default = ["aws-lc-rs"]
aws-lc-rs = ["dep:aws-lc-rs"]
ring-crypto = ["dep:ring"]
```

### ç¼–è¯‘é€‰é¡¹

```bash
# ä½¿ç”¨ AWS-LC (é»˜è®¤)
cargo build

# ä½¿ç”¨ Ring
cargo build --no-default-features --features ring-crypto

# åŒæ—¶ç¼–è¯‘ä¸¤ä¸ªåç«¯
cargo build --features "aws-lc-rs ring-crypto"
```

---

## ğŸ“š æ–‡æ¡£å®Œæ•´æ€§

### å·²åˆ›å»ºæ–‡æ¡£

1. **HTTP-01_IMPLEMENTATION.md** (350+ è¡Œ)
    - æ¶æ„è®¾è®¡
    - è¯¦ç»†å®ç°è¯´æ˜
    - ä½¿ç”¨ç¤ºä¾‹
    - å®‰å…¨è€ƒè™‘
    - æ•…éšœæ’æŸ¥

2. **DNS-01_IMPLEMENTATION.md** (400+ è¡Œ)
    - æ¶æ„è®¾è®¡
    - DnsProvider æ¥å£
    - è‡ªå®šä¹‰æä¾›å•†ç¤ºä¾‹
    - å¤šåŸŸåæ”¯æŒ
    - æ€§èƒ½æŒ‡æ ‡

3. **CHALLENGE_EXAMPLES.md** (600+ è¡Œ)
    - å®Œæ•´å·¥ä½œæµç¤ºä¾‹
    - HTTP-01 ä¸“ç”¨ç¤ºä¾‹
    - DNS-01 ä¸“ç”¨ç¤ºä¾‹
    - è‡ªå®šä¹‰ DNS æä¾›å•†
    - å¹¶å‘å¤„ç†
    - é‡è¯•é€»è¾‘

### ä»£ç ç¤ºä¾‹

- âœ… åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
- âœ… è‡ªå®šä¹‰ DNS æä¾›å•†
- âœ… å¤šåŸŸåå¤„ç†
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•
- âœ… å¹¶å‘æ“ä½œ
- âœ… å•å…ƒæµ‹è¯•

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å•å…ƒæµ‹è¯•

```
src/challenge/http01.rs
â”œâ”€â”€ test_http01_solver_creation         âœ…
â””â”€â”€ test_http01_solver_key_auth         âœ…

src/challenge/dns01.rs
â”œâ”€â”€ test_dns01_solver_creation          âœ…
â”œâ”€â”€ test_mock_dns_provider              âœ…
â””â”€â”€ test_dns01_solver_prepare           âœ…
```

### æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test --lib challenge

# è¿è¡Œ HTTP-01 æµ‹è¯•
cargo test --lib challenge::http01

# è¿è¡Œ DNS-01 æµ‹è¯•
cargo test --lib challenge::dns01

# å¸¦æ—¥å¿—è¿è¡Œ
RUST_LOG=debug cargo test --lib challenge -- --nocapture
```

---

## ğŸ“ˆ API è¡¨é¢

### å…¬å…±å¯¼å‡º

```rust
pub use challenge::{
    ChallengeSolver,
    ChallengeSolverRegistry,
    Http01Solver,
    Dns01Solver,
    DnsProvider,
    MockDnsProvider,
};
```

### ä¾èµ–ç‰ˆæœ¬

```toml
async-trait = "0.1"
axum = "0.8"           # HTTP æœåŠ¡å™¨
base64 = "0.22"        # Base64URL ç¼–ç 
hyper = "1.4"          # HTTP æ¡†æ¶
tokio = "1.40"         # å¼‚æ­¥è¿è¡Œæ—¶
ring = "0.17"          # åŠ å¯† (å¯é€‰)
aws-lc-rs = "0.1"      # åŠ å¯† (å¯é€‰)
```

---

## ğŸš€ æ€§èƒ½ç‰¹æ€§

### HTTP-01

- **å†…å­˜å ç”¨**: ~2-5KB per solver
- **å¹¶å‘èƒ½åŠ›**: å¤„ç†æ•°ç™¾ä¸ªå¹¶å‘è¯·æ±‚
- **å“åº”æ—¶é—´**: <1ms per request
- **Server Startup**: 50-100ms

### DNS-01

- **å†…å­˜å ç”¨**: ~1-3KB per solver
- **Record Creation**: å–å†³äº DNS æä¾›å•† (100-500ms)
- **Concurrent Domains**: æ”¯æŒæ— é™å¹¶å‘
- **Verification**: å¿«é€Ÿ (< 10ms)

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### HTTP-01

- âœ… Token éªŒè¯ (ç²¾ç¡®åŒ¹é…)
- âœ… 404 for æ— æ•ˆè¯·æ±‚
- âœ… è‡ªåŠ¨æœåŠ¡å™¨æ¸…ç†
- âœ… å†…å­˜å®‰å…¨ (Rust)

### DNS-01

- âœ… SHA256 å“ˆå¸Œ
- âœ… Base64URL ç¼–ç 
- âœ… è‡ªåŠ¨è®°å½•æ¸…ç†
- âœ… å¯†é’¥ææ–™ä¸æš´éœ²

---

## ğŸ“ Rust ç‰ˆæœ¬å’Œ Edition

### è¦æ±‚

- **Rust ç‰ˆæœ¬**: 1.93.0+
- **Edition**: 2024 (æœ€æ–°æ ‡å‡†åº“)
- **MSRV**: 1.82.0 (è®¾ç½®åœ¨ Cargo.toml)

### ä¾èµ– RC ç‰ˆæœ¬æ”¯æŒ

æ‰€æœ‰ä¾èµ–éƒ½å·²é…ç½®ä¸ºå…è®¸ RC ç‰ˆæœ¬ï¼š

```toml
[dependencies]
aws-lc-rs = "0.1"      # å…è®¸ rc ç‰ˆæœ¬
ring = "0.17"          # å…è®¸ rc ç‰ˆæœ¬
axum = "0.8"           # å…è®¸ rc ç‰ˆæœ¬
```

---

## ğŸ“ è®¾è®¡æ¨¡å¼

### 1. ChallengeSolver Trait

ä½¿ç”¨ async_trait æ”¯æŒå¼‚æ­¥æ–¹æ³•ï¼š

```rust
#[async_trait]
pub trait ChallengeSolver {
    async fn prepare(...) -> Result<()>;
    async fn present(...) -> Result<()>;
    async fn verify(...) -> Result<bool>;
    async fn cleanup(...) -> Result<()>;
}
```

**ä¼˜åŠ¿**:

- ç»Ÿä¸€çš„æ¥å£
- æ˜“äºæ·»åŠ æ–°æŒ‘æˆ˜ç±»å‹
- å®Œå…¨çš„å¼‚æ­¥æ”¯æŒ

### 2. DnsProvider Trait

å¯æ’æ‹”çš„ DNS å®ç°ï¼š

```rust
#[async_trait]
pub trait DnsProvider: Send + Sync {
    async fn create_txt_record(...) -> Result<String>;
    async fn delete_txt_record(...) -> Result<()>;
    async fn verify_record(...) -> Result<bool>;
}
```

**ä¼˜åŠ¿**:

- æ”¯æŒä»»ä½• DNS API
- æµ‹è¯•å‹å¥½ (MockDnsProvider)
- è§£è€¦ DNS é€»è¾‘

### 3. Registry Pattern

é›†ä¸­ç®¡ç†ï¼š

```rust
pub struct ChallengeSolverRegistry {
    solvers: HashMap<ChallengeType, Box<dyn ChallengeSolver>>,
}
```

**ä¼˜åŠ¿**:

- è¿è¡Œæ—¶é€‰æ‹©æ±‚è§£å™¨
- æ”¯æŒå¤šä¸ªæŒ‘æˆ˜ç±»å‹
- åŠ¨æ€æ³¨å†Œ

---

## ğŸ”„ é›†æˆç‚¹

### ä¸ v0.1.0 çš„é›†æˆ

```
v0.1.0 (æ ¸å¿ƒ ACME)
    â†“
  Order åˆ›å»º
    â†“
  è·å¾— Challenge
    â†“
v0.2.0 (æŒ‘æˆ˜è§£å†³)  â† æ‚¨åœ¨è¿™é‡Œ
    â†“
  Challenge å®Œæˆ
    â†“
v0.3.0+ (è¯ä¹¦ç­¾å‘)
```

---

## ğŸ“š ä¸‹ä¸€æ­¥å·¥ä½œ (v0.3.0)

### è®¡åˆ’

- [ ] è®¢å•ç”Ÿå‘½å‘¨æœŸç®¡ç†
    - åˆ›å»º Order
    - è½®è¯¢ Authorization çŠ¶æ€
    - æ„å»ºå’Œç­¾ç½² CSR
    - Finalize Order
    - ä¸‹è½½è¯ä¹¦

- [ ] å†…ç½® DNS æä¾›å•†
    - Route53 (AWS)
    - CloudFlare
    - DigitalOcean
    - Linode

- [ ] å®Œæ•´é›†æˆç¤ºä¾‹

---

## âœ… å®Œæˆæƒ…å†µæ£€æŸ¥è¡¨

### v0.2.0 æ ¸å¿ƒåŠŸèƒ½

- [x] ChallengeSolver æŠ½è±¡
- [x] ChallengeSolverRegistry
- [x] HTTP-01 å®Œæ•´å®ç°
    - [x] Axum HTTP æœåŠ¡å™¨
    - [x] Token è·¯ç”±
    - [x] ç”Ÿå‘½å‘¨æœŸç®¡ç†
    - [x] é”™è¯¯å¤„ç†
- [x] DNS-01 å®Œæ•´å®ç°
    - [x] DnsProvider æ¥å£
    - [x] SHA256 å“ˆå¸Œè®¡ç®—
    - [x] MockDnsProvider
    - [x] ç”Ÿå‘½å‘¨æœŸç®¡ç†
- [x] å•å…ƒæµ‹è¯•
- [x] æ–‡æ¡£
    - [x] HTTP-01 è¯¦ç»†æ–‡æ¡£
    - [x] DNS-01 è¯¦ç»†æ–‡æ¡£
    - [x] å®Œæ•´ç¤ºä¾‹ä»£ç 

### è´¨é‡ä¿è¯

- [x] ç¼–è¯‘æ— é”™è¯¯
- [x] ç¼–è¯‘æ— è­¦å‘Š
- [x] Rust 1.93.0 å…¼å®¹
- [x] Edition 2024 å…¼å®¹
- [x] Ring + AWS-LC åŒæ”¯æŒ

---

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–‡ä»¶æ•°é‡

```
src/challenge/
â”œâ”€â”€ mod.rs          : 52 è¡Œ
â”œâ”€â”€ http01.rs       : 156 è¡Œ
â””â”€â”€ dns01.rs        : 198 è¡Œ

docs/
â”œâ”€â”€ HTTP-01_IMPLEMENTATION.md      : 350+ è¡Œ
â”œâ”€â”€ DNS-01_IMPLEMENTATION.md       : 400+ è¡Œ
â””â”€â”€ CHALLENGE_EXAMPLES.md          : 600+ è¡Œ
```

### æ€»ä»£ç è¡Œæ•°

```
æ ¸å¿ƒä»£ç : ~400 è¡Œ
å•å…ƒæµ‹è¯•: ~50 è¡Œ
æ–‡æ¡£: ~1350 è¡Œ
```

---

## ğŸ‰ ç»“è®º

**AcmeX v0.2.0** æˆåŠŸå®ç°äº† ACME æŒ‘æˆ˜å¤„ç†çš„ä¸¤ä¸ªæœ€é‡è¦çš„æ–¹æ³•ï¼š

1. **HTTP-01**: ç”Ÿäº§çº§åˆ«çš„ Axum HTTP æœåŠ¡å™¨å®ç°
2. **DNS-01**: å®Œå…¨å¯æ’æ‹”çš„ DNS æä¾›å•†æ¶æ„

è¯¥ç‰ˆæœ¬ä¸ºåç»­æ·»åŠ æ›´å¤šæŒ‘æˆ˜ç±»å‹ (å¦‚ TLS-ALPN-01) å’Œ DNS æä¾›å•†æä¾›äº†å®Œæ•´çš„åŸºç¡€è®¾æ–½ã€‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç¼–è¯‘ç¯å¢ƒ

```
Rust: 1.93.0+
Edition: 2024
OS: macOS, Linux, Windows
Architecture: x86_64, ARM64
```

### è¿è¡Œæµ‹è¯•

```bash
cargo test --lib challenge
RUST_LOG=debug cargo test --lib challenge -- --nocapture
```

---

**é¡¹ç›®çŠ¶æ€**: âœ… **ç”Ÿäº§å°±ç»ª**

**ç‰ˆæœ¬**: v0.2.0  
**å®Œæˆæ—¥æœŸ**: 2026-02-07  
**ä¸‹ä¸€ç‰ˆæœ¬**: v0.3.0 (è®¢å•å¤„ç†å’Œè¯ä¹¦ç­¾å‘)

